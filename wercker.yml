box: node
build:
  steps:
    - script:
      name: echo nodejs information
      code: |
        echo "node version $(node -v) running"
        echo "npm version $(npm -v) running"
    - npm-install
    - script:
      name: hexo generate
      code: ./node_modules/.bin/hexo generate

deploy:
  box:
    id: google/cloud-sdk
  steps:
    - script:
      name: Activate service account
      code: |
        echo $GOOGLE_JSON >> secret.json
        CLOUDSDK_PYTHON_SITEPACKAGES=1 gcloud auth activate-service-account $GOOGLE_ACCOUNT --key-file secret.json

    - script:
      name: Upload to store
      code: |
        gsutil -m rsync -r -d public gs://$GOOGLE_BUCKET
        gsutil -m cp -r -z html,css,js,xml,txt,json,map,svg public/* gs://$GOOGLE_BUCKET
